<!doctype html>
<html class="no-js">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>后台管理系统--更新车</title>
    <meta name="description" content="这是一个后台车 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="/admin/assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="/admin/assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <link rel="stylesheet" href="/admin/assets/css/amazeui.min.css" />
    <link rel="stylesheet" href="/admin/assets/css/admin.css">
    <link rel="stylesheet" href="/layui/css/layui.css">
    <script src="/admin/assets/js/jquery.min.js"></script>
    <script src="/admin/assets/js/app.js"></script>
    <script src="/layui/layui.js"></script>
    <style>
        /*body{padding: 20px;}*/
        
        .demo-input {
            padding-left: 10px;
            height: 38px;
            min-width: 262px;
            line-height: 38px;
            border: 1px solid #e6e6e6;
            background-color: #fff;
            border-radius: 2px;
        }
        
        .demo-footer {
            padding: 50px 0;
            color: #999;
            font-size: 14px;
        }
        
        .demo-footer a {
            padding: 0 5px;
            color: #01AAED;
        }
        
        label {
            white-space: nowrap;
        }
    </style>
</head>


<body>
    <header class="am-topbar admin-header">
        <div class="am-topbar-brand"><img src="/admin/assets/i/logo.png"></div>

        <div class="am-collapse am-topbar-collapse" id="topbar-collapse">
            <ul class="am-nav am-nav-pills am-topbar-nav admin-header-list">

                <li class="am-dropdown tognzhi" data-am-dropdown>
                    <button class="am-btn am-btn-primary am-dropdown-toggle am-btn-xs am-radius am-icon-bell-o" data-am-dropdown-toggle> 后台管理<span class="am-badge am-badge-danger am-round">^</span></button>
                    <ul class="am-dropdown-content">

                        <li class="am-dropdown-header">跳到到后台首页</li>
                        <li><a href="/pages/managerUser.html">首页<span class="am-badge am-badge-danger am-round"></span></a></li>

                    </ul>
                </li>

                <li class="kuanjie">

                    <a href="/pages/managerUser.html">用户管理</a>
                    <a href="/pages/managerClient.html">客户管理</a>
                    <a href="/pages/managerOrder.html">订单管理</a>
                    <a href="/pages/managerCar.html">车辆管理</a>
                    <a href="/pages/managerDeposit.html">收入管理</a>
                    <a href="/pages/managerNotice.html">消息管理</a>
                </li>

            </ul>
        </div>
    </header>

    <div class="am-cf admin-main">

        <div class="nav-navicon admin-main admin-sidebar">


            <div class="sideMenu am-icon-dashboard" style="color:#aeb2b7; margin: 10px 0 0 0;"> 欢迎系统管理员admin</div>
            <div class="sideMenu">
                <h3 class="am-icon-flag"><em></em> <a href="#">用户管理</a></h3>
                <ul>
                    <li><a href="/pages/addUser.html">添加用户</a></li>

                    <li><a href="/pages/managerUser.html">用户管理</a></li>

                </ul>
                <h3 class="am-icon-users"><em></em> <a href="#">客户管理</a></h3>
                <ul>
                    <li><a href="/pages/addClient.html">添加客户</a> </li>
                    <li><a href="/pages/managerClient.html">客户管理</a> </li>
                </ul>
                <h3 class="am-icon-cart-plus"><em></em> <a href="#"> 订单管理</a></h3>
                <ul>
                    <li><a href="/pages/addOrder.html">添加订单</a></li>
                    <li><a href="/pages/managerOrder.html">订单管理</a></li>

                </ul>
                <h3 class="am-icon-users on"><em></em> <a href="#">车辆管理</a></h3>
                <ul>
                    <li><a href="/pages/addCar.html">增加车辆</a></li>
                    <li><a href="/pages/managerCar.html">车辆管理</a></li>
                </ul>
                <h3 class="am-icon-gears"><em></em> <a href="#">收入管理</a></h3>
                <ul>
                    <li><a href="/pages/addPay.html">充值</a></li>
                    <li><a href="/pages/managerDeposit.html">退押金</a></li>

                </ul>
                <h3 class="am-icon-volume-up"><em></em> <a href="#">消息管理</a></h3>
                <ul>
                    <li><a href="/pages/addNotice.html">添加消息</a></li>
                    <li><a href="/pages/managerNotice.html">消息管理</a></li>

                </ul>

            </div>
            <!-- sideMenu End -->

            <script type="text/javascript">
                jQuery(".sideMenu").slide({
                    titCell: "h3", //鼠标触发对象
                    targetCell: "ul", //与titCell一一对应，第n个titCell控制第n个targetCell的显示隐藏
                    effect: "slideDown", //targetCell下拉效果
                    delayTime: 300, //效果时间
                    triggerTime: 150, //鼠标延迟触发时间（默认150）
                    defaultPlay: true, //默认是否执行效果（默认true）
                    returnDefault: true //鼠标从.sideMen移走后返回默认状态（默认false）
                });
            </script>
        </div>

        <div class=" admin-content">

            <div class="daohang">
                <ul>
                    <li><button type="button" class="am-btn am-btn-default am-radius am-btn-xs"> 车管理 > </li>
				<li><button type="button" class="am-btn am-btn-default am-radius am-btn-xs"> 添加->更新 </li>
			</ul>

       

	
</div>

<div class="admin-biaogelist">
            <div style="padding: 15px">
                <table class="layui-table" id="LAY_table_car">

                </table>
            </div>
            <script type="text/html" id="barDemo">
                <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                <!-- <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a> -->
            </script>
            <!-- 修改车 -->
            <div style="display: none" id="edit_car_template">
                <form class="layui-form" action="" lay-filter="edit_car" style="margin:20px;">


                    <!-- 车辆类型 -->
                    <div class="layui-form-item">
                        <label class="layui-form-label">车辆类型</label>
                        <div class="layui-input-block">
                            <input type="radio" name="reserve" value="0" title="行政" checked="">
                            <input type="radio" name="reserve" value="1" title="长租">
                        </div>
                    </div>
                    <!--车辆状态-->
                    <div class="layui-form-item">
                        <label class="layui-form-label">车辆状态</label>
                        <div class="layui-input-block">
                            <input type="radio" name="status" value="ENABLE" title="上线" checked="">
                            <input type="radio" name="status" value="DISABLE" title="下线">
                        </div>
                    </div>
                    <!--油百分比-->
                    <div class="layui-form-item">
                        <label class="layui-form-label">油百分比</label>
                        <div class="layui-input-block">
                            <input type="number" name="percent" autocomplete="off" placeholder="请输入用户名" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div style="text-align: center;">
                            <button class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
                        </div>
                    </div>
                </form>
            </div>
            <script type="text/html" id="status">
                <!-- 这里的 checked 的状态只是演示 -->

                {{ d.status=="ENABLE" ? '上线' : '下线' }}

            </script>
            <script type="text/html" id="reserve">
                <!-- 这里的 checked 的状态只是演示 -->

                {{ d.reserve==1 ? '长租' : '行政' }}

            </script>
        </div>

    </div>

    </div>
    <script src="/admin/assets/js/amazeui.min.js"></script>

</body>
<script>
    // 生成table
    layui.use('table', function() {
        var table = layui.table;
        //方法级渲染

        table.render({
            elem: '#LAY_table_car',
            url: '/car/showList',
            cols: [
                [{
                        field: 'id',
                        title: 'ID',
                        width: 80,
                        sort: true,
                    }, {
                        field: 'reserve',
                        title: '车辆类型',
                        width: 180,
                        templet: '#reserve'
                    }, {
                        field: 'status',
                        title: '车辆状态',
                        width: 180,
                        templet: '#status'
                    },
                    // {
                    //     field: 'status',
                    //     title: '上线-下线',
                    //     width: 180,
                    //     sort: true
                    // }, 
                    {
                        field: 'percent',
                        title: '油百分比',
                        width: 180,
                    }, {
                        field: 'createTime',
                        title: '创建时间',
                    }, {
                        width: 178,
                        title: '操作',
                        align: 'center',
                        toolbar: '#barDemo'
                    }
                ]
            ],
            id: 'testReload',
            page: true,
        });

        active = {
            reload: function() {
                var demoReload = $('#demoReload');

                //执行重载
                table.reload('testReload', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    },
                    where: {
                        key: {
                            id: demoReload.val()
                        }
                    }
                });
            }
        };


        //监听工具条
        table.on('tool', function(obj) {
            var data = obj.data;
            if (obj.event === 'del') {
                //执行删除
                layer.confirm('确认删除用户吗', function(index) {
                    console.log(data);
                    $.ajax({
                        url: "/car/delete?id=" + data.id,
                        type: "DELETE",
                        success: function(message) {
                            console.log(message);
                            // 关闭弹窗
                            layer.closeAll();
                            // 修改成功之后刷新
                            active['reload']();
                            layer.msg('删除成功');
                        },
                        error: function(data) {
                            layer.msg('出现错误');
                        }
                    })
                });
            } else if (obj.event === 'edit') {
                //执行修改
               
                activePop('edit_car_template', data);
               
            }
        });
    });

    function setForm(initValue) {
        layui.use(['form'], function() {
            var form = layui.form
                //自定义验证规则
            form.verify({
                
                pass: [/(.+){6,12}$/, '密码必须6到12位']
                   
            });
            //监听提交
            form.on('submit(demo1)', function(data) {
                data.field.id = initValue.id;
                $.ajax({
                    url: "/car/update",
                    type: "PUT",
                    data: JSON.stringify(data.field),
                    contentType: "application/json",
                    dataType: 'json',
                    success: function(message) {
                        console.log(message);
                        // 关闭弹窗
                        layer.closeAll();
                        // 修改成功之后刷新
                        active['reload']();
                        layer.msg('修改成功');
                    },
                    error: function(data) {
                        layer.msg('出现错误');
                    }
                })
                return false;
            });
            // 防止status为数字类型，导致无法设置默认值
            initValue.reserve = initValue.reserve.toString();
            //表单初始赋值
            if (initValue) {
                form.val('edit_car', initValue);
            }
        });
    }
    //触发事件
    function activePop(id, initValue) {
        layer.open({
            type: 1,
            area: ['500px', '360px'],
            content: document.getElementById(id).innerHTML //传入表单html
                // ,btn: '关闭全部'
                ,
            btnAlign: 'c' //按钮居中
                ,
            shade: 0 //不显示遮罩
                // ,yes: function(){
                //     layer.closeAll();
                // }
        });
        //打开后设置form
        setForm(initValue);
    }
</script>

</html>